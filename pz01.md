## Практическое занятие №1. Создание виртуальной машины на базе ОС Linux

Ознакомтесь с [основными правилами](http://192.168.64.246/anetto/bos/blob/master/rules.md).

Зачёт (в конце первого семестра) и экзамен (в конце второго) по дисциплине содержит 2 теоретических вопроса и задачу. Задача аналогична проблеме, решаемой в рамках практического занятия или лабораторной работы.

Слушатель должен уметь развёрнуто отвечать на **рассматриваемые вопросы** и понимать все **термины, которые нужно усвоить**. Вопросы, помеченные словом **усвоить**, требуют дополнительной проработки слушателем.

### Рассматриваемые вопросы
1. Преимущества виртуализации.
2. Недостатки виртуализации.
3. Взаимодействие гостевой и хостовой ОС.
4. Преимущества разделения жесткого диска на разделы.

### Термины, которые нужно усвоить
* fs
* хостовая машина
* гостевая ВМ
* .
* ..
* cat

### Отчёт по пз
* скриншот окна выделения раздела /home в соответствии с номером по журналу (шаблон названия "5-07-1 Иванов home" для слушателя с фамилией Иванов и 7 по списку в группе 25)
* скриншот полученной таблицы разделов (шаблон названия "5-07-2 Иванов partitions")

Файлы называть по формату "5-07-1 Иванов home" и 5-07-2 Иванов partitions" для слушателя с фамилией Иванов из группы 25 и 7 по списку в группе 25. Скриншоты скопировать в \\\\fs\prepods\ваш\_преподаватель\for\_write\BOS\pz1.

### Ход работы
1.    Знакомство с сетевым хранилищем.
    * \\\\fs\prepods\name - сетевой каталог преподавателя, где "name" - узнать у преподавателя;
    * \\\\fs\prepods\name\to_read - содержит файлы для раздачи (лекции, книги, примеры);
    * \\\\fs\prepods\name\to_write - служит для сдачи преподавателю материалов в электронном виде;
    * \\\\fs\Кафедры\732\БОС - основной каталог с данными по дисциплине;
    * \\\\fs\дистрибутивы - место хранения образов в сети;
    * \\\\fs\home - личный сетевой каталог слушателя;
    
    Данные с рабочего стола между компьютерами в разных аудиториях не переносятся и могут быть удалены, используйте \\fs\home.
    **Усвоить** разницу хостовой и гостевой ОС.

1.  Скопируйте из \\\\fs\Кафедры\732\БОС\iso файл ubuntu-18.04.1-desktop-amd64.iso на рабочий стол.
2.    Создание виртуальной машины (ВМ) в VMWare. Созданная машина нужна в пределах этого занятия, остальное время вы будете работать с преднастроенной машиной.
    * **выборочной** конфигурации (custom, не typical):
    * оборудование по умолчанию;
    * **ОС не устанавливать**, Linux-Ubuntu-64bit. Если выбрать iso сразу, то будет так называемый easy_install без выбора разделов и прочего, для учебных целей не подходит;
    * имя машины UbuntuSurname (Surname - фамилия слушателя), запомнить расположение создаваемой ВМ;
    * конфигурация процессора: 1 процессор, 2 ядра;
    * оперативной памяти 2048 мегабайта;
    * тип сети NAT (**усвоить** разницу разных вариантов сетевых интерфейсов, [подробнее про сетевые интерфейсы](http://gitlabnto/anetto/wiki/wikis/vm-network));
    * контроллеры ввода-вывода по умолчанию;
    * тип диска по умолчанию;
    * создать новый виртуальный диск в 40 гигабайт, в нескольких файлах. **Уяснить**, чем отличается хранение в одном файле от разбиения по нескольким файлам, и что значит галочка "выделить всё дисковое пространство сейчас".

3.    Запуск ВМ. 
    * Запустить ВМ без образа;
    * Посмотреть на попытку получения сетевого адреса по DHCP и загрузку по сети;
    * Вернуть фокус мыши из гостевой ОС в хостовую (нажать ctrl+alt, подсказка внизу окна VMWare);
    * Сверху, где "пауза", нажать на выпадающий список. Выбрать "завершить работу гостевой ОС";
    * Обратите внимание на поле "описание" - тут удобно хранить логин и пароль для виртуальной машины общего пользования и описание применения ВМ или установленного софта;
    * Зайти в настройки виртуальной машины, вкладка hardware, CD/DVD (SATA).
    * Изменить "подключение" с "физический диск" на файл образа ISO, указать путь к ubuntu-18.04.1-desktop-amd64.iso на рабочем столе.

    **Усвоить** порядок именования релизов ubuntu и разрядность x86 vs x86-64(amd64).

4.    Установка гостевой ОС (Ubuntu Desktop LTS).
    * выбрать русский язык;
    * Выбрать пункт меню "Install ubuntu" (обратите внимание на пункт Try Ubuntu - это возможность использовать так называемый live CD, когда вы с флешки запускаете полноценную ubuntu без установки);
    * обычная загрузка, не выбирать пункт "установить стороннее ПО" (в учебных целях для ускорения установки, на практике устанавливайте стороннее ПО);
    * Тип установки - другой вариант. 
    * Дальше необходимо делить жесткий диск на разделы. Одно из применений деления на разделы - на одном физическом жестком диске можно иметь несколько разных операционных систем (так называемый dual boot для windows+ubuntu или multi boot для множества ОС). Деление на разделы имеет смысл и для одной ОС - удобно отделять программы (для которых не особо критично резервное копирование) от пользовательских данных (для которых резервное копирование крайне важно). На Windows часто делают диск C: для программ и диск D: для пользовательских данных. Такой подход позволяет упростить переустановку системы - форматируется только системный раздел, а раздел с пользовательскими данными остаётся в исходном виде.
    * Создать новую таблицу разделов, выделить строку "свободное пространство", внизу плюс для добавления разделов. **Усвоить разницу** первичного и логического разделов.
    * Нужно выделить разделы под boot, swap, / и /home. Начнём с небольших по размеру boot и swap, а остальное место распределим между / и /home.
    * Добавить логический раздел в конец пространства размером 2048 мегабайт, использовать как раздел подкачки (пояснить что это такое). Общая рекомендация - swap стоит указывать 1х ОЗУ или 2х ОЗУ.
    * Добавить 300 МБ первичный раздел в начала пространства, ext2, точка монтирования /boot.
    * Добавить 20 000 + номер по журналу (у 3 по журналу слушателя должно быть выделено, например, 20003 МБ) оставшегося места на первичный раздел в начала пространства, ext4, точка монтирования /home. **Сделать скриншот** окна выделения раздела /home. **Уяснить**, с чем связано отличие запрошенного и реально выделенного места.
    * Добавить оставшееся место на первичный раздел в начало пространства, ext4, точка монтирования /.
    * **Сделать скриншот** получившейся таблицы разделов.
    * Выбрать имя пользователя - фамилия слушателя (например, ivanov);
    * Выбрать имя компьютера ivanov-7, где ivanov - фамилия слушателя, 7 - его номер по журналу;
    * После установки в настройках ВМ переключить CD/DVD-устройство с .iso на физический привод;
    * Если виртуальная машина повисла, то сделать reset гостевой ОС (выпадающий список рядом со значком паузы вверху).

    **Усвоить** смысл деления на разделы. [Подробнее про файловые системы](http://gitlabnto/anetto/wiki/wikis/linux-filesystem)

    Для домашнего компьютера с системой ssd+hdd имеет смысл делать так:
    
    ssd: 25% с точкой монтирования / (но не менее 20 гигабайт), 75% с точкой монтирования /home, 2хОЗУ на swap
        
    hdd: /storage

5.  Настройка гостевой ВМ
    * Использовать ctrl+alt для переключения указателя мыши из гостевой ОС в хостовую;
    * Переключение раскладки языка win+пробел (win - это кнопка с логотипом windows, она также называется super);
    * Установить VMware tools (в окне снизу или вверху VM-install VMware tools). **Не сработает, если подключён установочный iso**;
    * Открыть проводник nautilus, выбрать появившийся CD-диск vmware tools;
    * В диска скопировать архив vmware-tools.tar.gz на рабочий стол (рабочий стол тоже есть в панели слева);
    * Извлечь архив на рабочий стол;
    * Открыть полученный каталог в терминале (правой кнопкой - открыть в терминале);
    * При возникновении вопросов по работе с командой строкой заглянуть в [справочник](http://gitlabnto/anetto/wiki/wikis/bash);
    * Команда ls показывает содержимое текущего каталога, cd <имя> позволяет перейти в каталог имя (можно делать cd <каталог1/каталог2/каталог3>);
    * Выполнить (**пользоваться** кнопкой tab для автодополнения)
    
    ```bash
    cat INSTALL | less
    ```
    * cat обеспечиват вывод файла на стандартный вывод, вертикальная черта обозначает неименованный канал (pipe) передачи данных от процесса слева процессу справа, less позволяет перемещаться вверх и вниз по содержимому файла. Для выхода из less нажмите q;
    * В первых строках файла INSTALL описано, что нужно выполнить для установки:
    
    ```bash
    sudo ./install.pl
    ```
    * Если tab не дополнил имя файла до конца, то двойное нажатие tab показывает возможные варианты выбора;
    * Точка . обозначает текущую директорию, две точки .. обозначают родительскую директорию текущей директории;
    * При установке нажать "enter" для ответа на ряд вопросов;
    * Через несколько минут получить надпись "enjoy";
    * В консоли для перезагрузки гостевой ОС (**не нужно** пользоваться кнопкой "перезагрузить гостевую ОС" в VMWare без необходимости вроде подвисшей ВМ) набрать
    
    ```bash
    sudo reboot 
    ```

5.  Проверка связи гостевой ВМ и хоста
    * Попробовать перетащить (скопировать) файл из хостовой в гостевую ВМ (и обратно);
    * Попробовать скопировать блок текста (ctrl+c, ctrl+v) из хостовой в гостевую ВМ (и обратно);
    * В гостевой ВМ открыть проводник, нажать слева снизу "подключиться к", в адрес сервера ввести smb://fs. Здесь smb - это протокол samba для доступа к сетевому ресурсу;
    * После нажатия "ок" подождать около минуты. Появится окно ввода, ввести свой логин от **хостовой ОС** и пароль от учётной записи **хоста**, домен cc;
    * Создать общую папку для хостовой и гостевой ВМ в настройках виртуальной машины (настройки - параметры - общие папки).