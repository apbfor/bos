### Практическое занятие №16. Смена пароля  учетной записи при физическом доступе к ОС Windows

Из прошлого семестра известною, что ОС Linux хранит данные о пользователях в понятном виде, в текстовых файлах. В Windows все иначе. Все учетные записи пользователей вместе с соответствующими им хэш-функциями паролей хранятся в так называемой базе SAM (Security Accounts Manager). Она представляет собой одноименный файл, который не имеет расширения. SAM-файл является составной частью реестра и хранится в каталоге %systemroot%\system32\config (под %systemroot% понимается каталог с операционной системой — по умолчанию соответствует каталогу C:\WINDOWS). 

#### Рассматриваемые вопросы

1. Получение доступа к учетной записи Администратора (2 способа)
2. Пользователи в Windows

#### Термины, которые нужно усвоить

- dir
- copy
- net user
- /?
- discpart, list volume, exit
- regedit

#### Отчет по ПЗ

- продемонстрировать преподавателю, что при нажатии опции "Специальные возможности*" происходит вызов командной строки
- продемонстрировать преподавателю, что во время запуска ВМ машины появляется командная строка

#### Ход работы

1. Запустить  виртуальную машину и остановиться там, где нужно вводить пароль от учетной записи;

2. **Первый способ** получить доступ к учетной записи Администратора системы

   Не заходя в свою учетную запись, вы можете включить "*Специальные возможности*" (снизу второй значок справа) или включить залипание клавиш (пятикратным нажатием *Shift*). Причем обе эти утилиты запускаются от имени администратора. Этим и воспользуемся для сброса пароля.

   **Суть метода**: необходимо в системе подменить файл sethc.exe (Залипание клавиш) или файл utilman.exe (Специальные возможности) на файл командной строки cmd.exe. После подмены, при загрузки Windows, можно включить залипание клавиш или Специальные возможности. А так как мы подменили файл одной из этих утилит на файл командной строки, то откроется именно окно командной строки, запущенное с правами Администратора. Это означает, что теперь можно выполнять любые команды без входа в систему.

   - Вставить загрузочный диск или флешку c Windows 

     для ВМ: *VM->Setings>CD/DVD (SATA)*, указать образ с Windows 10;

   - зайти в BIOS (UEFI)

     в ВМ попасть в биос можно по классике, клацая *F2* или *Del* при загрузки системы, либо выключить машину, зайти в *VM->Power-> Power on to Firmware*;

   - загрузиться с загрузочного носителя

     Если бы вы работали не в виртуальной машине, то вам бы пришлось менять в биосе порядок загрузки, а в ВМ нужно после того как попали в упрощенный BIOS выбрать *EFI VMWare Virtual SATA CDROM Drive*, начнется загрузка с носителя;

   - когда загрузка дойдет до первого диалогового окна, нажать сочетание *Shift+F10*, откроется командная строка;

   - посмотреть, какие диски есть в системе, запустив утилиту *diskpart* и введя команду *list volume*, выйти из утилиты можно командой *exit*;

   - c помощью команды *dir <название диска>* (например dir D:\) по косвенным признакам (наличие системных папок) найти системный диск.

     **Замечание**: пусть далее диск С: будет системным

   - осуществить подмену утилиты sethc.exe (либо utilman.exe) на cmd.exe

     - создать резервную копию файла sethc.exe (чтобы после всех манипуляций была возможность вернуть всё как было), сохранив его, например, в корень диска С: (в вашем случае буква может отличаться)

       `copy c:\windows\System32\sethc.exe c:\`

     - заменить файл sethc.exe файлом cmd.exe

       `copy с:\windows\System32\cmd.exe с:\windows\System32\sethc.exe` 

       на запрос замены файлов ответить Y (Yes)

   - перезагрузить ВМ

   - пятикратно нажать *Shift*, откроется командная строка

   - посмотреть пользователей системы командой *net user*

   - изменим пароль пользователю Администратор командой *net user Администратор *, после будет предложено ввести новый пароль 

     **Замечание**: справку по любой команде можно получить так: *имя_команды /?*

   Таким образом вы смогли получить доступ к учетной записи Администратора системы

   - продемонстрировать преподавателю, что в окне входа в учетную запись после пятикратного нажатия Shift, появляется командная
   - **самостоятельно** осуществить обратную замену и **показать** преподавателю

3. **Второй способ** получить доступ к учетной записи Администратора системы

   - Аналогично предыдущему методу, дойти до момента, когда после нажатия *Shift+F10* появляется командная строка;
   - запустить редактор реестра командой *regedit*;
   - выбрать раздел *HKEY_LOCAL_MACHINE;*
   - загрузить ветку реестра: в верхнем меню *File->Load Hive*;
   - перейти в *C:\Windows\System32\config*, выбрать файл *SYSTEM;*
   - windows запросит название будущего параметра, это не имеет значение, ввести любое слово маленькими латинскими буквами;
   - перейти к созданному разделу реестра и выделить внутри папку Setup;
   - в правой части экрана: ключу CmdLine присвоить значение cmd.exe (правой кнопкой по ключу-> Modify), ключу SetupType присвоить значение 2;
   - выделить созданный раздел реестра и выгрузить его (File->Unload Hive), подтвердить действие;
   - закрыть редактор реестра, закрыть командную строку, закрыть установщик Windows
   - машина начнет перегружаться, **продемонстрировать** преподавателю, что во время загрузки системы появится окно командной строки;
   - аналогично прошлому методу можно изменить пароль любого пользователя системы.

**Резюме**: на примере убедились насколько опасно, когда злоумышленник имеет физический доступ к ПК, одним из способов защиты является использование шифрования, о котором поговорим в дальнейшем.



